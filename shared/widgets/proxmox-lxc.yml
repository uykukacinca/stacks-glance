proxmox-lxc: &proxmox-lxc
  type: custom-api
  title: Proxmox Containers
  cache: *short-cache
  url: ${PROXMOXVE_URL}/api2/json/cluster/resources?type=vm
  headers:
    Accept: application/json
    Authorization: PVEAPIToken=${PROXMOXVE_KEY}
  template: |
    <div class="widget-table widget-proxmox-lxc">
      <table>

        <thead>
          <tr>
            <th>ID</th>
            <th>Container</th>
            <th>CPU Usage</th>
            <th colspan="2">Memory Usage</th>
            <th colspan="2">Disk Usage</th>
          </tr>
        </thead>

        <tbody>
          {{ range .JSON.Array "data" }}
          {{ if ne (.String "type") "lxc" }}{{ continue }}{{ end }}
            <tr class="proxmox-lxc {{ .String "status" }}">

              <td class="lxc-vmid size-h4">{{ .String "vmid" }}</td>

              <td class="flex items-center gap-7">
                <span class="lxc-status"></span>
                <a class="lxc-name size-h4" target="_blank" href="${PROXMOXVE_URL}/#v1:0:=lxc/{{ .Int "vmid" }}">{{ .String "name" }}</a>
              </td>

              <td>
                <span class="lxc-value perc" data-value="{{ mul (.Float "cpu") 100 | toInt | formatNumber }}"></span><span class="affix">%</span>
                of 
                <span class="lxc-value perc" data-value="{{ .Int "maxcpu" }}"></span> CPUs
              </td>

              <td>
                <span class="lxc-value perc" data-value="{{ mul (div (.Int "mem" | toFloat) (.Int "maxmem" | toFloat)) 100 | toInt }}"></span><span class="affix">%</span>
              </td>
              <td>
                <span class="lxc-value" data-value="{{ div (.Int "mem" | toFloat) 1073741824 | printf "%.2f" | formatNumber }}"></span>gb ↔ 
                <span class="lxc-value" data-value="{{ div (.Int "maxmem" | toFloat) 1073741824 | printf "%.0f" | formatNumber }}"></span>gb
              </td>
              
              <td>
                <span class="lxc-value perc" data-value="{{ mul (div (.Int "disk" | toFloat) (.Int "maxdisk" | toFloat)) 100 | toInt }}"></span><span class="affix">%</span>
              </td>
              <td>
                <span class="lxc-value" data-value="{{ div (.Int "disk" | toFloat) 1073741824 | printf "%.2f" | formatNumber }}"></span>gb ↔ 
                <span class="lxc-value" data-value="{{ div (.Int "maxdisk" | toFloat) 1073741824 | printf "%.f" | formatNumber }}"></span>gb
              </td>

            </tr>
          {{ end }}
        </tbody>

      </table>
    </div>