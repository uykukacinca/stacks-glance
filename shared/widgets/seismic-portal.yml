widget: &seismic-portal
  type: custom-api
  title: Seismic Portal 3+
  cache: *short-cache
  url: https://www.seismicportal.eu/fdsnws/event/1/query
  parameters:
    limit: 20
    lat: 41
    lon: 29
    minradius: 0
    maxradius: 1.5
    format: json
    minmag: 3
  options:
    collapse-after: 5
  template: |
    {{ $collapseAfter := .Options.IntOr "collapse-after" 10 }}
    <ul class="list list-gap-10 collapsible-container" data-collapse-after="{{ $collapseAfter }}">
    {{ range .JSON.Array "features" }}
      {{ $id := .String "properties.source_id" }}
      {{ $img := printf "%s/%s/%s/%s.local" (slice $id 0 3) (slice $id 0 4) $id $id }}
      <li class="flex">
        <div data-popover-type="html">
          <div data-popover-html="">
            <div class="margin-bottom-5">
              <a href="https://static1.emsc.eu/Images/EVID_V2/{{ $img }}.jpg" target="_blank">
                <img class="thumbnail" src="https://static1.emsc.eu/Images/EVID_V2/{{ $img }}.thumb.jpg" loading="lazy" />
              </a>
            </div>
            <div><span>{{ .String "properties.time" | parseLocalTime "rfc3339" }}</span></div>
            <div>Last Update: <span {{ .String "properties.lastupdate" | parseTime "rfc3339" | toRelativeTime }}></span></div>
            <div>Magnitude: <span class="color-highlight">{{ .String "properties.mag" }}</span></div>
            <div>Latitude: <span class="color-highlight">{{ .String "properties.lat" }}</span></div>
            <div>Longitude: <span class="color-highlight">{{ .String "properties.lon" }}</span></div>
            <div>Depth: <span class="color-highlight">{{ .String "properties.depth" }}</span></div>
            <div>Region: <span class="color-highlight">{{ .String "properties.flynn_region" }}</span></div>
            <div>Source: <span>{{ .String "properties.source_catalog" }}</span></div>
          </div>
          <ul class="list-horizontal-text">
            <li><span {{ .String "properties.time" | parseTime "rfc3339" | toRelativeTime }}></span></li>
            <li><a href="https://emsc.eu/Earthquake_information/earthquake.php?id={{ $id }}" target="_blank" class="color-highlight color-primary-if-not-visited">{{ .String "properties.mag" }}</a></li>
            <li>{{ .String "properties.auth" }}</li>
          </ul>
        </div>
      </li>
    {{ end }}
    </ul>