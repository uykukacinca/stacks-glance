- &jellyfin-base
  type: custom-api
  title: Jellyfin Recently Added
  cache: *default-cache
  url: ${JELLYFIN_URL}/emby/Users/${JELLYFIN_USER}/Items/Latest
  # https://api.jellyfin.org/#tag/Items/operation/GetItems
  headers:
    Accept: application/json
    X-Emby-Token: ${JELLYFIN_KEY}

- &jellyfin-recent-movies
  <<: *jellyfin-base
  title: Jellyfin Latest Movies
  parameters:
    SortBy: DateCreated,SortName,ProductionYear
    SortOrder: Descending
    GroupItems: false
    Recursive: false
    IncludeItemTypes: Movie
    Fields: Genres,ExternalUrls,ProviderIds
    StartIndex: 0
    ParentId: f137a2dd21bbc1b99aa5c0f6bf02a805
    Limit: 15
    #Filters: IsUnPlayed
  template: |
    {{ $collapseAfter := .Options.IntOr "collapse-after" 5 }}
    {{ $items := .JSON.Array "" }}
    {{ if $items }}
      <ul class="list list-gap-14 collapsible-container" data-collapse-after="{{ $collapseAfter }}">
        {{ range $items }}
        <li>
            <div class="flex gap-10 row-reverse-on-mobile thumbnail-parent">
                <div class="shrink-0" data-popover-type="html">
                  <div data-popover-html="">
                      <img src="${JELLYFIN_URL}/Items/{{ .String "Id" }}/Images/Thumb?fillHeight=547&fillWidth=364&quality=96&tag={{ .String "ImageTags.Thumb" }}" loading="lazy" alt="">
                  </div>
                  <img class="twitch-category-thumbnail thumbnail cover-6-66 aspect-ratio-3-4" src="${JELLYFIN_URL}/Items/{{ .String "Id" }}/Images/Primary?fillHeight=547&fillWidth=364&quality=96&tag={{ .String "ImageTags.Primary" }}" alt="{{ .String "Name" }}" loading="lazy">
                </div>
                <div class="grow min-width-0">
                    <a href="${JELLYFIN_URL}/web/index.html#/details?id={{ .String "Id" }}&serverId={{ .String "ServerId" }}" class="color-highlight size-title-dynamic block text-truncate" target="_blank" rel="noreferrer">{{ .String "Name" }}</a>
                    <ul class="list-horizontal-text flex-nowrap text-compact">
                        <li class="shrink-0">{{ .String "ProductionYear" }}</li>
                        <li class="shrink-0 flex gap-5 items-center">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="icon-14">
                            <path fill-rule="evenodd" d="M8 1.75a.75.75 0 0 1 .692.462l1.41 3.393 3.664.293a.75.75 0 0 1 .428 1.317l-2.791 2.39.853 3.575a.75.75 0 0 1-1.12.814L7.998 12.08l-3.135 1.915a.75.75 0 0 1-1.12-.814l.852-3.574-2.79-2.39a.75.75 0 0 1 .427-1.318l3.663-.293 1.41-3.393A.75.75 0 0 1 8 1.75Z" clip-rule="evenodd" />
                          </svg>
                          {{ printf "%.1f\n" (.Float "CommunityRating") }}
                        </li>
                        {{ $duration := .Int "RunTimeTicks" }}
                        {{ $durationMins := div (div $duration 10000000) 60 }}
                        {{ $hours := div $durationMins 60 }}
                        {{ $minutes := mod $durationMins 60 }}
                        <li class="flex gap-5 items-center">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="icon-14">
                            <path fill-rule="evenodd" d="M1 8a7 7 0 1 1 14 0A7 7 0 0 1 1 8Zm7.75-4.25a.75.75 0 0 0-1.5 0V8c0 .414.336.75.75.75h3.25a.75.75 0 0 0 0-1.5h-2.5v-3.5Z" clip-rule="evenodd" />
                          </svg>
                        {{ if gt $hours 0 }}
                          {{ printf "%dh %dm" $hours $minutes }}
                        {{ else }}
                          {{ printf "%dm" $minutes }}
                        {{ end }}
                        </li>
                    </ul>
                    <ul class="list-horizontal-text flex-nowrap text-truncate">
                      {{ range $i, $genre := .Array "GenreItems" }}
                        {{ if eq $i 3 }}
                          {{ break }}
                        {{ end }}
                        <li>{{ $genre.String "Name" }}</li>
                      {{ end }}
                    </ul>
                </div>
            </div>
        </li>
        {{ end }}
      </ul>
    {{ else }}
      <p>Failed to fetch data</p>
    {{ end }}

- &jellyfin-recent-episodes
  <<: *jellyfin-base
  title: Jellyfin Latest Episodes
  parameters:
    SortBy: DateCreated,SeriesSortName,SortName
    SortOrder: Descending
    GroupItems: false
    Recursive: false
    IncludeItemTypes: Episode
    Fields: Genres,ExternalUrls,ProviderIds
    StartIndex: 0
    ParentId: a656b907eb3a73532e40e44b968d0225
    Limit: 15
  template: |
    {{ $collapseAfter := .Options.IntOr "collapse-after" 5 }}
    {{ $items := .JSON.Array "" }}
    {{ if $items }}
      <ul class="list list-gap-14 collapsible-container" data-collapse-after="{{ $collapseAfter }}">
        {{ range $items }}
        <li>
            <div class="flex gap-10 row-reverse-on-mobile thumbnail-parent">
                <div class="shrink-0" data-popover-type="html">
                  {{ $cover := .Int "RunTimeTicks" }}
                  <div data-popover-html="">
                      <img src="${JELLYFIN_URL}/Items/{{ .String "Id" }}/Images/Primary?fillHeight=547&fillWidth=364&quality=96&tag={{ .String "ImageTags.Primary" }}" loading="lazy" alt="">
                  </div>
                  <img class="twitch-category-thumbnail thumbnail cover-6-66 aspect-ratio-3-4" src="${JELLYFIN_URL}/Items/{{ .String "SeasonId" }}/Images/Primary?fillHeight=547&fillWidth=364&quality=96&tag={{ .String "ImageTags.Primary" }}" alt="{{ .String "Name" }}" loading="lazy">
                </div>
                <div class="grow min-width-0">
                    <a href="${JELLYFIN_URL}/web/index.html#/details?id={{ .String "Id" }}&serverId={{ .String "ServerId" }}" class="color-highlight size-title-dynamic block text-truncate" target="_blank" rel="noreferrer">{{ .String "Name" }}</a>
                    <div>{{ .String "SeriesName" }}</div>
                    <ul class="list-horizontal-text flex-nowrap text-compact">
                        <li class="shrink-0">{{ .String "SeasonName" | replaceAll "Season " "S" }} E{{ .String "IndexNumber" }}</li>
                        <li class="shrink-0 flex gap-5 items-center">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="icon-14">
                            <path fill-rule="evenodd" d="M8 1.75a.75.75 0 0 1 .692.462l1.41 3.393 3.664.293a.75.75 0 0 1 .428 1.317l-2.791 2.39.853 3.575a.75.75 0 0 1-1.12.814L7.998 12.08l-3.135 1.915a.75.75 0 0 1-1.12-.814l.852-3.574-2.79-2.39a.75.75 0 0 1 .427-1.318l3.663-.293 1.41-3.393A.75.75 0 0 1 8 1.75Z" clip-rule="evenodd" />
                          </svg>
                          {{ printf "%.1f\n" (.Float "CommunityRating") }}
                        </li>
                        {{ $duration := .Int "RunTimeTicks" }}
                        {{ $durationMins := div (div $duration 10000000) 60 }}
                        {{ $hours := div $durationMins 60 }}
                        {{ $minutes := mod $durationMins 60 }}
                        <li class="flex gap-5 items-center">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="icon-14">
                            <path fill-rule="evenodd" d="M1 8a7 7 0 1 1 14 0A7 7 0 0 1 1 8Zm7.75-4.25a.75.75 0 0 0-1.5 0V8c0 .414.336.75.75.75h3.25a.75.75 0 0 0 0-1.5h-2.5v-3.5Z" clip-rule="evenodd" />
                          </svg>
                        {{ if gt $hours 0 }}
                          {{ printf "%dh %dm" $hours $minutes }}
                        {{ else }}
                          {{ printf "%dm" $minutes }}
                        {{ end }}
                        </li>
                    </ul>
                    <ul class="list-horizontal-text flex-nowrap text-truncate">
                      {{ range .Array "movie.genres" }}
                        <li>{{ .String "" }}</li>
                      {{ end }}
                    </ul>
                </div>
            </div>
        </li>
        {{ end }}
      </ul>
    {{ else }}
      <p>Failed to fetch data</p>
    {{ end }}

- &jellyfin-next-up
  <<: *jellyfin-base
  title: Jellyfin Next Up
  url: ${JELLYFIN_URL}/emby/Shows/NextUp
  frameless: true
  parameters:
    UserId: ${JELLYFIN_USER}
    EnableResumable: true
    StartIndex: 0
    Limit: 15
  template: |
    $include: jellyfin-home/utils.gohtml
    $include: jellyfin-home/card-thumb.gohtml
    {{ $collapseAfter := .Options.IntOr "collapse-after" 5 }}
    {{ $items := .JSON.Array "Items" }}
    {{ if $items }}

              <div
                class="glimpse-cards-grid glimpse-collapsible-container jellyfin-cards jellyfin-cards-thumb}"
                data-collapse-after-rows="1"
                display="resume"
              >
                {{ range $n, $item := $items }}
                  {{ template "card-thumb" $item }}
                {{ end }}
              </div>
    {{ else }}
      <div class="widget-content ">
        <p>No items found</p>
      </div>
    {{ end }}
